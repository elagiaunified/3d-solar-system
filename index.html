<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar System Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0a0e27;
            color: #e8e8f0;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        #canvas-container {
            width: 100%;
            height: 100%;
            cursor: grab;
        }

        #canvas-container:active {
            cursor: grabbing;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* Header */
        .header {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            pointer-events: none;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 400px;
        }

        /* Control Panel */
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            width: 280px;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
        }

        .control-section {
            margin-bottom: 24px;
        }

        .control-section:not(:last-child) {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 20px;
        }

        .control-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .slider-container {
            margin-bottom: 16px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 6px;
            opacity: 0.8;
        }

        input[type="range"] {
            width: 100%;
            height: 4px;
            -webkit-appearance: none;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #4a90e2;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #4a90e2;
            color: white;
            flex: 1;
        }

        button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }

        button:active {
            transform: translateY(0);
        }

        button.active {
            background: #2e5c8a;
        }

        .tool-button {
            width: 100%;
            text-align: left;
            padding: 10px 12px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controls-info {
            font-size: 0.75rem;
            line-height: 1.4;
            opacity: 0.7;
        }

        .controls-info div {
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* Info Panel */
        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            width: 320px;
            max-height: 70vh;
            overflow-y: auto;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            pointer-events: auto;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .info-panel.visible {
            opacity: 1;
        }

        .info-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .info-header h3 {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            color: inherit;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.6;
            padding: 0;
            width: auto;
        }

        .close-btn:hover {
            opacity: 1;
        }

        .info-description {
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .info-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .info-section-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .info-item {
            font-size: 0.8rem;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-label {
            opacity: 0.8;
        }

        .info-value {
            font-weight: 500;
        }

        /* Tool Indicators */
        .tool-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 31, 58, 0.9);
            backdrop-filter: blur(10px);
            padding: 16px 24px;
            border-radius: 12px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            z-index: 50;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tool-indicator.visible {
            opacity: 1;
        }

        .measure-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 8px 0;
            color: #8b5cf6;
        }

        .tool-instruction {
            font-size: 0.8rem;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="spaceCanvas"></canvas>
    </div>

    <!-- Header -->
    <div class="header">
        <h1>Solar System Explorer</h1>
        <p>Complete Interactive 3D Solar System with Physics & Educational Tools</p>
    </div>

    <!-- Control Panel -->
    <div class="control-panel">
        <div class="control-section">
            <div class="control-title">‚è±Ô∏è TIME CONTROLS</div>
            <div class="slider-container">
                <div class="slider-label">
                    <span>Speed:</span>
                    <span id="speedDisplay">1.0x</span>
                </div>
                <input type="range" id="speedSlider" min="0" max="50" value="10">
            </div>
            <div class="button-group">
                <button id="pauseBtn">‚è∏Ô∏è Pause</button>
                <button id="resetBtn">‚Ü∫ Reset</button>
            </div>
        </div>

        <div class="control-section">
            <div class="control-title">üîß TOOLS</div>
            <button id="measureBtn" class="tool-button">üìè Distance Measure</button>
            <button id="lagrangeBtn" class="tool-button">üéØ Lagrange Points</button>
            <button id="habitableBtn" class="tool-button">üå°Ô∏è Habitable Zone</button>
            <button id="gravityBtn" class="tool-button">‚ö° Gravity Wells</button>
            <button id="quizBtn" class="tool-button">üéì Quiz Challenge</button>
        </div>

        <div class="control-section">
            <div class="control-title">üéÆ CONTROLS</div>
            <div class="controls-info">
                <div>üñ±Ô∏è Drag to rotate</div>
                <div>üîç Scroll to zoom</div>
                <div>üñ±Ô∏è Click planets for info</div>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div id="infoPanel" class="info-panel">
        <div class="info-header">
            <h3 id="objectName">Sun</h3>
            <button id="closeInfo" class="close-btn">√ó</button>
        </div>
        <p id="objectDescription" class="info-description">
            The star at the center of our solar system, containing 99.86% of the system's mass.
        </p>
        
        <div class="info-section">
            <div class="info-section-title">üìä Orbital Data</div>
            <div class="info-item">
                <span class="info-label">Distance from Sun:</span>
                <span id="distanceInfo" class="info-value">0 AU</span>
            </div>
            <div class="info-item">
                <span class="info-label">Orbital Period:</span>
                <span id="periodInfo" class="info-value">N/A</span>
            </div>
            <div class="info-item">
                <span class="info-label">Orbital Velocity:</span>
                <span id="velocityInfo" class="info-value">N/A</span>
            </div>
        </div>

        <div class="info-section">
            <div class="info-section-title">üåç Physical Properties</div>
            <div class="info-item">
                <span class="info-label">Diameter:</span>
                <span id="sizeInfo" class="info-value">1,391,000 km</span>
            </div>
            <div class="info-item">
                <span class="info-label">Mass:</span>
                <span id="massInfo" class="info-value">1.989 √ó 10¬≥‚Å∞ kg</span>
            </div>
            <div class="info-item">
                <span class="info-label">Gravity:</span>
                <span id="gravityInfo" class="info-value">274 m/s¬≤</span>
            </div>
        </div>

        <div class="info-section">
            <div class="info-section-title">üî¨ Composition</div>
            <div id="compositionInfo" class="info-item" style="display: block;">
                73% Hydrogen, 25% Helium, 2% heavier elements
            </div>
        </div>

        <div class="info-section">
            <div class="info-section-title">üöÄ Travel Time from Earth</div>
            <div id="travelInfo" class="info-item" style="display: block;">
                N/A - Too hot to approach!
            </div>
        </div>
    </div>

    <!-- Measurement Tool -->
    <div id="measureDisplay" class="tool-indicator">
        <div class="tool-instruction">Distance</div>
        <div id="measureValue" class="measure-value">0 AU</div>
        <div class="tool-instruction">Click two objects to measure</div>
    </div>

    <script>
        // Initialize canvas and context
        const canvas = document.getElementById('spaceCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // State variables
        let width = canvas.width;
        let height = canvas.height;
        let centerX = width / 2;
        let centerY = height / 2;
        let rotation = { x: 0, y: 0 };
        let zoom = 1.0;
        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let isPaused = false;
        let timeSpeed = 1.0;
        let time = 0;
        let selectedObject = null;

        // Tool states
        let showLagrange = false;
        let showHabitable = false;
        let showGravity = false;
        let measureMode = false;
        let measurePoint1 = null;
        let measurePoint2 = null;

        // Celestial bodies data
        const celestialBodies = {
            sun: {
                name: "Sun",
                radius: 35,
                color: ["#FFF9E6", "#FFD700"],
                distance: 0,
                period: 0,
                angle: 0,
                description: "The star at the center of our solar system, containing 99.86% of the system's mass.",
                distanceText: "0 AU",
                periodText: "N/A",
                velocity: "N/A",
                diameter: "1,391,000 km",
                mass: "1.989 √ó 10¬≥‚Å∞ kg",
                gravity: "274 m/s¬≤",
                composition: "73% Hydrogen, 25% Helium, 2% heavier elements",
                travel: "N/A - Too hot to approach!"
            },
            mercury: {
                name: "Mercury",
                radius: 8,
                color: ["#B8B8B8", "#8A8A8A"],
                distance: 90,
                period: 88,
                angle: 0,
                description: "Smallest planet and closest to the Sun. No atmosphere and extreme temperature variations.",
                distanceText: "0.39 AU (58M km)",
                periodText: "88 days",
                velocity: "47.4 km/s",
                diameter: "4,879 km",
                mass: "3.3 √ó 10¬≤¬≥ kg",
                gravity: "3.7 m/s¬≤",
                composition: "Rocky planet - Iron core (70%), Silicate mantle",
                travel: "~6-7 months with current technology"
            },
            venus: {
                name: "Venus",
                radius: 15,
                color: ["#FFC649", "#E8A030"],
                distance: 130,
                period: 225,
                angle: 1.5,
                description: "Hottest planet with a thick toxic atmosphere. Rotates backwards compared to most planets.",
                distanceText: "0.72 AU (108M km)",
                periodText: "225 days",
                velocity: "35.0 km/s",
                diameter: "12,104 km",
                mass: "4.87 √ó 10¬≤‚Å¥ kg",
                gravity: "8.9 m/s¬≤",
                composition: "Rocky - CO‚ÇÇ atmosphere (96.5%), Sulfuric acid clouds",
                travel: "~5 months with current technology"
            },
            earth: {
                name: "Earth",
                radius: 16,
                color: ["#6B9BD1", "#2E5C8A"],
                distance: 180,
                period: 365,
                angle: 3,
                description: "Our home planet. Only known world with life. 71% covered by water with nitrogen-oxygen atmosphere.",
                distanceText: "1.0 AU (150M km)",
                periodText: "365.25 days",
                velocity: "29.8 km/s",
                diameter: "12,742 km",
                mass: "5.97 √ó 10¬≤‚Å¥ kg",
                gravity: "9.8 m/s¬≤",
                composition: "Rocky - N‚ÇÇ/O‚ÇÇ atmosphere, liquid water, iron/nickel core",
                travel: "You're already here! üåç"
            },
            mars: {
                name: "Mars",
                radius: 12,
                color: ["#E27B58", "#C1440E"],
                distance: 240,
                period: 687,
                angle: 4.5,
                description: "The Red Planet with the largest volcano and canyon in the solar system. Prime candidate for colonization.",
                distanceText: "1.52 AU (228M km)",
                periodText: "687 days",
                velocity: "24.1 km/s",
                diameter: "6,779 km",
                mass: "6.42 √ó 10¬≤¬≥ kg",
                gravity: "3.7 m/s¬≤",
                composition: "Rocky - Thin CO‚ÇÇ atmosphere, iron oxide surface, polar ice caps",
                travel: "~7-9 months with current technology"
            },
            jupiter: {
                name: "Jupiter",
                radius: 30,
                color: ["#E8B882", "#C4935B"],
                distance: 350,
                period: 4333,
                angle: 6,
                description: "Largest planet with a mass greater than all other planets combined. Famous Great Red Spot storm.",
                distanceText: "5.2 AU (778M km)",
                periodText: "11.9 years",
                velocity: "13.1 km/s",
                diameter: "139,820 km",
                mass: "1.90 √ó 10¬≤‚Å∑ kg",
                gravity: "24.8 m/s¬≤",
                composition: "Gas giant - 90% H‚ÇÇ, 10% He. No solid surface",
                travel: "~13 months to 2 years (Voyager: 18 months)"
            },
            saturn: {
                name: "Saturn",
                radius: 26,
                color: ["#F4E8C1", "#D4C18A"],
                distance: 450,
                period: 10759,
                angle: 7.5,
                description: "Famous for its spectacular ring system made of ice and rock. Least dense planet - would float in water!",
                distanceText: "9.5 AU (1.4B km)",
                periodText: "29.5 years",
                velocity: "9.7 km/s",
                diameter: "116,460 km",
                mass: "5.68 √ó 10¬≤‚Å∂ kg",
                gravity: "10.4 m/s¬≤",
                composition: "Gas giant - H‚ÇÇ/He with magnificent ring system",
                travel: "~3-4 years (Cassini: 7 years)"
            }
        };

        // Drawing functions
        function drawBackground() {
            ctx.fillStyle = '#0a0e27';
            ctx.fillRect(0, 0, width, height);
            
            // Draw stars
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 200; i++) {
                const x = Math.random() * width;
                const y = Math.random() * height;
                const size = Math.random() * 1.5;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawOrbit(distance, highlight = false) {
            ctx.strokeStyle = highlight ? 'rgba(255, 255, 255, 0.3)' : 'rgba(255, 255, 255, 0.1)';
            ctx.lineWidth = highlight ? 2 : 1;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, distance * zoom, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawSphere(x, y, radius, colors) {
            // Create gradient for glow effect
            const gradient = ctx.createRadialGradient(
                x - radius * 0.3, y - radius * 0.3, 0,
                x, y, radius * zoom * 1.5
            );
            gradient.addColorStop(0, colors[0] + 'FF');
            gradient.addColorStop(0.7, colors[1] + 'CC');
            gradient.addColorStop(1, colors[1] + '00');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(x, y, radius * zoom * 1.5, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw planet body
            const bodyGradient = ctx.createRadialGradient(
                x - radius * 0.2, y - radius * 0.2, 0,
                x, y, radius * zoom
            );
            bodyGradient.addColorStop(0, colors[0]);
            bodyGradient.addColorStop(1, colors[1]);
            
            ctx.fillStyle = bodyGradient;
            ctx.beginPath();
            ctx.arc(x, y, radius * zoom, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawHabitableZone() {
            const inner = 160 * zoom;
            const outer = 200 * zoom;
            
            const gradient = ctx.createRadialGradient(
                centerX, centerY, inner,
                centerX, centerY, outer
            );
            gradient.addColorStop(0, 'rgba(50, 205, 50, 0.1)');
            gradient.addColorStop(0.5, 'rgba(50, 205, 50, 0.15)');
            gradient.addColorStop(1, 'rgba(50, 205, 50, 0.1)');
            
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(centerX, centerY, outer, 0, Math.PI * 2);
            ctx.arc(centerX, centerY, inner, 0, Math.PI * 2, true);
            ctx.fill();
            
            ctx.strokeStyle = 'rgba(50, 205, 50, 0.5)';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 5]);
            ctx.beginPath();
            ctx.arc(centerX, centerY, inner, 0, Math.PI * 2);
            ctx.stroke();
            ctx.beginPath();
            ctx.arc(centerX, centerY, outer, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawGravityWells() {
            Object.values(celestialBodies).forEach(body => {
                const pos = getPosition(body);
                const gravityRadius = Math.log(body.radius + 1) * 40;
                
                const gradient = ctx.createRadialGradient(
                    pos.x, pos.y, body.radius * zoom,
                    pos.x, pos.y, gravityRadius * zoom
                );
                gradient.addColorStop(0, body.color[1] + '40');
                gradient.addColorStop(1, body.color[1] + '00');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(pos.x, pos.y, gravityRadius * zoom, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function getPosition(body) {
            const angle = body.angle + rotation.y;
            return {
                x: centerX + Math.cos(angle) * body.distance * zoom,
                y: centerY + Math.sin(angle) * body.distance * zoom
            };
        }

        function findObjectAtPoint(x, y) {
            // Check Sun first (it's at center)
            const sun = celestialBodies.sun;
            const sunPos = getPosition(sun);
            const sunDistance = Math.sqrt(
                Math.pow(x - sunPos.x, 2) + Math.pow(y - sunPos.y, 2)
            );
            
            if (sunDistance <= sun.radius * zoom * 1.5) {
                return 'sun';
            }
            
            // Check other planets
            const planets = ['mercury', 'venus', 'earth', 'mars', 'jupiter', 'saturn'];
            for (const planetName of planets) {
                const body = celestialBodies[planetName];
                const pos = getPosition(body);
                const distance = Math.sqrt(
                    Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2)
                );
                
                if (distance <= body.radius * zoom * 1.2) {
                    return planetName;
                }
            }
            
            return null;
        }

        function updateInfoPanel(planetName) {
            const body = celestialBodies[planetName];
            document.getElementById('objectName').textContent = body.name;
            document.getElementById('objectDescription').textContent = body.description;
            document.getElementById('distanceInfo').textContent = body.distanceText;
            document.getElementById('periodInfo').textContent = body.periodText;
            document.getElementById('velocityInfo').textContent = body.velocity;
            document.getElementById('sizeInfo').textContent = body.diameter;
            document.getElementById('massInfo').textContent = body.mass;
            document.getElementById('gravityInfo').textContent = body.gravity;
            document.getElementById('compositionInfo').textContent = body.composition;
            document.getElementById('travelInfo').textContent = body.travel;
            
            document.getElementById('infoPanel').classList.add('visible');
        }

        function render() {
            width = canvas.width;
            height = canvas.height;
            centerX = width / 2;
            centerY = height / 2;
            
            drawBackground();
            
            // Draw orbits
            Object.values(celestialBodies).forEach(body => {
                if (body.distance > 0) {
                    drawOrbit(body.distance, selectedObject && celestialBodies[selectedObject] === body);
                }
            });
            
            // Draw habitable zone
            if (showHabitable) {
                drawHabitableZone();
            }
            
            // Draw gravity wells
            if (showGravity) {
                drawGravityWells();
            }
            
            // Draw planets
            Object.entries(celestialBodies).forEach(([name, body]) => {
                const pos = getPosition(body);
                drawSphere(pos.x, pos.y, body.radius, body.color);
                
                // Highlight selected planet
                if (selectedObject === name) {
                    ctx.strokeStyle = '#4a90e2';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, (body.radius + 5) * zoom, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
            
            // Draw measurement line if in measure mode
            if (measureMode && measurePoint1) {
                const pos1 = getPosition(celestialBodies[measurePoint1]);
                ctx.strokeStyle = '#8b5cf6';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(pos1.x, pos1.y, 10, 0, Math.PI * 2);
                ctx.stroke();
                
                if (measurePoint2) {
                    const pos2 = getPosition(celestialBodies[measurePoint2]);
                    ctx.beginPath();
                    ctx.moveTo(pos1.x, pos1.y);
                    ctx.lineTo(pos2.x, pos2.y);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.arc(pos2.x, pos2.y, 10, 0, Math.PI * 2);
                    ctx.stroke();
                }
            }
        }

        function animate() {
            if (!isPaused) {
                time += 0.0005 * timeSpeed;
                
                // Update planet positions
                Object.values(celestialBodies).forEach(body => {
                    if (body.period > 0) {
                        body.angle = time * (2 * Math.PI / body.period) * 100;
                    }
                });
            }
            
            render();
            requestAnimationFrame(animate);
        }

        // Event Listeners
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const clickedObj = findObjectAtPoint(mouseX, mouseY);
            
            if (measureMode && clickedObj) {
                if (!measurePoint1) {
                    measurePoint1 = clickedObj;
                } else if (!measurePoint2) {
                    measurePoint2 = clickedObj;
                    // Calculate and display distance
                    const body1 = celestialBodies[measurePoint1];
                    const body2 = celestialBodies[measurePoint2];
                    const distance = Math.abs(body2.distance - body1.distance);
                    const au = (distance / 180).toFixed(2);
                    const km = (au * 150).toFixed(0);
                    
                    document.getElementById('measureValue').textContent = `${au} AU (${km}M km)`;
                    document.getElementById('measureDisplay').classList.add('visible');
                } else {
                    measurePoint1 = clickedObj;
                    measurePoint2 = null;
                    document.getElementById('measureDisplay').classList.remove('visible');
                }
            } else if (clickedObj) {
                selectedObject = clickedObj;
                updateInfoPanel(clickedObj);
            } else {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvas.style.cursor = 'grabbing';
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            // Update cursor
            const hoveredObj = findObjectAtPoint(mouseX, mouseY);
            canvas.style.cursor = hoveredObj ? 'pointer' : (isDragging ? 'grabbing' : 'grab');
            
            if (isDragging) {
                const deltaX = e.clientX - lastMouseX;
                const deltaY = e.clientY - lastMouseY;
                
                rotation.y += deltaX * 0.01;
                rotation.x += deltaY * 0.01;
                
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('mouseleave', () => {
            isDragging = false;
            canvas.style.cursor = 'grab';
        });

        canvas.addEventListener('wheel', (e) => {
            e.preventDefault();
            const zoomSpeed = 0.001;
            zoom += e.deltaY * -zoomSpeed;
            zoom = Math.max(0.3, Math.min(3, zoom));
        }, { passive: false });

        // Control Panel Event Listeners
        document.getElementById('speedSlider').addEventListener('input', (e) => {
            timeSpeed = parseFloat(e.target.value) / 10;
            document.getElementById('speedDisplay').textContent = timeSpeed.toFixed(1) + 'x';
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
            document.getElementById('pauseBtn').textContent = isPaused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            time = 0;
            rotation = { x: 0, y: 0 };
            zoom = 1.0;
            selectedObject = null;
            document.getElementById('infoPanel').classList.remove('visible');
            Object.values(celestialBodies).forEach(body => {
                body.angle = 0;
            });
        });

        // Tool buttons
        const toolButtons = ['measureBtn', 'lagrangeBtn', 'habitableBtn', 'gravityBtn'];
        
        document.getElementById('measureBtn').addEventListener('click', () => {
            measureMode = !measureMode;
            document.getElementById('measureBtn').classList.toggle('active', measureMode);
            
            if (!measureMode) {
                measurePoint1 = null;
                measurePoint2 = null;
                document.getElementById('measureDisplay').classList.remove('visible');
            }
        });

        document.getElementById('habitableBtn').addEventListener('click', () => {
            showHabitable = !showHabitable;
            document.getElementById('habitableBtn').classList.toggle('active', showHabitable);
        });

        document.getElementById('gravityBtn').addEventListener('click', () => {
            showGravity = !showGravity;
            document.getElementById('gravityBtn').classList.toggle('active', showGravity);
        });

        document.getElementById('lagrangeBtn').addEventListener('click', () => {
            showLagrange = !showLagrange;
            document.getElementById('lagrangeBtn').classList.toggle('active', showLagrange);
            alert('Lagrange Points visualization coming soon!');
        });

        document.getElementById('quizBtn').addEventListener('click', () => {
            alert('Quiz feature coming soon!');
        });

        document.getElementById('closeInfo').addEventListener('click', () => {
            selectedObject = null;
            document.getElementById('infoPanel').classList.remove('visible');
        });

        // Initialize
        animate();
    </script>
</body>
</html>
